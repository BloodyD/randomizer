{% extends "base.html" %}


{%block head%}

  <style type="text/css">
    .dolly {
      visibility: hidden;
    }
  </style>

{%endblock%}



{% block content %}
  <div class="row">
    <div class="col-xs-6 well">
      <h4>Aufstellung</h4>
      {% if names %}
        <table class="table table-striped table-bordered" id="players">
          <thead>
            <tr>
              <th>Name</th>
              <th>Team <a class="btn btn-primary btn-xs pull-right random" data-toggle="button" for="team_selector">Zufall</a></th>
              <th>Volk <a class="btn btn-primary btn-xs pull-right random" data-toggle="button" for="nation_selector">Zufall</a></th>
            </tr>
          </thead>
          <tbody>

          {%for name in names %}
            <tr class="player-row" value="{{name}}">
              <td><span class="player-name">{{name}}</span><a class="btn btn-danger btn-xs pull-right remove"><span class="glyphicon glyphicon-remove"></span></a></td>
              <td>
                <select class="team_selector"></select>
              </td>
              <td>
                <select class="nation_selector">
                  {%for nation in nations%}
                    <option value="{{forloop.counter0}}">{{nation}}</option>
                  {%endfor%}
                </select>
              </td>
            </tr>
          {%endfor%}
            <tr class="player-row dolly" value="">
              <td><span class="player-name"></span><a class="btn btn-danger btn-xs pull-right remove"><span class="glyphicon glyphicon-remove"></span></a></td>
              <td>
                <select class="team_selector"></select>
              </td>
              <td>
                <select class="nation_selector">
                  {%for nation in nations%}
                    <option value="{{forloop.counter0}}">{{nation}}</option>
                  {%endfor%}
                </select>
              </td>
            </tr>
          </tbody>
        </table>
      {%endif%}


    </div>
    <div class="col-xs-3 well">
      <h4>Spieler</h4>
      <table class="table table-striped table-bordered" id="not_in_game">
        {% for name in not_in_game %}
          <tr value="{{name}}">
            <td>
              <span class="player-name">{{name}}</span>
              <a class="btn btn-success btn-xs pull-right add">
                <span class="glyphicon glyphicon-plus"></span>
              </a>
            </td>
          </tr>
        {% endfor %}
          <tr value="" class="dolly">
            <td>
              <span class="player-name"></span>
              <a class="btn btn-success btn-xs pull-right add">
                <span class="glyphicon glyphicon-plus"></span>
              </a>
            </td>
          </tr>
      </table>
    </div>
    <div class="col-xs-3 well">
      <h4>VÃ¶lker</h4>
      <table class="table table-striped table-bordered">
        {% for nation in nations %}
          <tr><td>
            <a class="btn btn-success btn-sm nation-select" value="{{nation}}" data-toggle="button">{{nation}}</a><br>
          </td></tr>
        {% endfor %}
    </div>
  </div>
{% endblock content %}

{%block script%}
  <script type="text/javascript">

    $(".team_selector").each(function () {
      for (var i = 1; i <= 4; i++) {
        this.appendChild(new Option(i, i))
      };
    });

    $(".random").click(function () {
      var btn = $(this);
      $("." + btn.attr("for")).each(function (argument) {
        $(this).attr("disabled", !btn.hasClass("active"));
      });
    });

    $(".nation-select").click(function () {
      if($(this).hasClass("active")){
        $(this).addClass("btn-success");
        $(this).removeClass("btn-danger");
      } else {
        $(this).removeClass("btn-success");
        $(this).addClass("btn-danger");
      }
    });

    function add (name, tbl) {
      var dolly = tbl.find("tbody > tr.dolly");
      console.log(dolly);
      var newRow = dolly.clone();
      newRow.attr("value", name);
      newRow.removeClass("dolly");
      newRow.find(".player-name").html(name);
      dolly.before(newRow);
      return newRow
    }

    function add_player () {
      var newRow = add($(this).parents("tr").attr("value"), $("#players"))
      newRow.find(".remove").click(remove_player);
      $(this).parents("tr").remove()
    }

    function remove_player(){
      var newRow = add($(this).siblings(".player-name").html(), $("#not_in_game"));
      newRow.find(".add").click(add_player);
      $(this).parents("tr").remove()
    }

    $(".add").click(add_player);

    $(".remove").click(remove_player);
  </script>
{%endblock script%}